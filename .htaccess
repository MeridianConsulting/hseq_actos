DirectoryIndex index.html
Options -Indexes

# Seguridad para contenido estático del frontend
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set X-Frame-Options "DENY"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), usb=(), payment=()"
  # CSP para app SPA; permite scripts/estilos/imágenes del mismo origen
  Header set Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; media-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' https: http:; frame-ancestors 'none'"
  Header always unset X-Powered-By
  Header unset X-Powered-By
  Header always set X-Permitted-Cross-Domain-Policies "none"
</IfModule>

# Detectar entorno local para evitar redirección HTTPS durante desarrollo
SetEnvIfNoCase Host "^(localhost|127\.0\.0\.1)(:\d+)?$" LOCAL_ENV=1

# Forzar HTTPS solo en entornos NO locales
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteCond %{ENV:LOCAL_ENV} !1
  RewriteCond %{HTTPS} !=on [OR]
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

<IfModule mod_headers.c>
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=!LOCAL_ENV
</IfModule>

# SPA routing: no reescribir llamadas a /api
<IfModule mod_rewrite.c>
  RewriteEngine On

  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  RewriteCond %{REQUEST_URI} ^/api/ [NC]
  RewriteRule ^ - [L]

  RewriteRule . /index.html [L]
</IfModule>

